# rql-parser

A Java Resource Query Language (RQL) parser using [ANTLR 4](https://www.antlr.org/). For an explanation of RQL please
see the [explanation from the persvr project](https://github.com/persvr/rql).

## Requirements

* Java 11 or higher

## Grammar

The grammar file can
be [viewed here](https://github.com/jazdw/rql-parser/blob/main/src/main/antlr4/net/jazdw/rql/Rql.g4).

## Usage

### Creating a parser

`RqlLexer` and `RqlParser` are generated by ANTLR and extend the ANTLR `Lexer` and `Parser` class respectively. For more
information see the [ANTLR 4 documentation](https://github.com/antlr/antlr4/blob/master/doc/index.md).

```java
public class RQLParserExample {
    public RqlParser createParser(String rql) {
        // create a lexer and set its input stream from an RQL string
        CharStream inputStream = CharStreams.fromString(rql);
        RqlLexer lexer = new RqlLexer(inputStream);
        // throw on lexer errors
        lexer.addErrorListener(new ThrowWithDetailsErrorListener());

        // get a token stream for the lexer
        CommonTokenStream tokenStream = new CommonTokenStream(lexer);

        // create a parser
        RqlParser parser = new RqlParser(tokenStream);
        // throw on parser errors
        parser.addErrorListener(new ThrowWithDetailsErrorListener());

        return parser;
    }
}
```

### Implement a visitor

`RqlBaseVisitor` implements the ANTLR interface `ParseTreeVisitor`. For more information see
the [ANTLR 4 documentation](https://github.com/antlr/antlr4/blob/master/doc/index.md).

```java
public class RQLParserExample {
    public void visit(RqlParser parser) {
        RqlBaseVisitor<DesiredType> visitor = new RqlBaseVisitor<>() {
            // extend me
        };

        DesiredType result = visitor.visit(parser.query());
    }
}
```

## Legacy usage

Note: The `RQLParser` class is still available in version 1.x, you can still use it to generate a tree of `ASTNode`
.

The parser generates an `ASTNode` object representing the root node of an Abstract Syntax Tree (AST). Create a class
that implements `ASTVisitor<R,A>` in order to traverse the tree.

````java
public class RQLParserExample {
    public void parse() {
        RQLParser parser = new RQLParser();
        MyVisitor visitor = new MyVisitor();
        ASTNode node = parser.parse("(name=jack|name=jill)&age>30");
        Object result = node.accept(visitor);
    }
}
````

## Examples

See [ListFilterTest](https://github.com/jazdw/rql-parser/blob/main/src/test/java/net/jazdw/rql/parser/ListFilterTest.java)
as an example of how to filter a list of objects using `QueryVisitor`.

## Maven Central Repository coordinates

````xml

<dependency>
    <groupId>net.jazdw</groupId>
    <artifactId>rql-parser</artifactId>
    <version>${rql.version}</version>
</dependency>
````
